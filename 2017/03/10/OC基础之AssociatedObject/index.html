<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> OC基础之AssociatedObject · 華</title><meta name="description" content="OC基础之AssociatedObject - 华子"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/timg.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="華"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/timg.jpeg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/huatianjie1" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/huaTJ0210" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">OC基础之AssociatedObject</h1><div class="post-info">Mar 10, 2017</div><div class="post-content"><h3 id="AssociatedObject-关联对象"><a href="#AssociatedObject-关联对象" class="headerlink" title="AssociatedObject(关联对象)"></a>AssociatedObject(关联对象)</h3><p> 在既有类中使用关联对象存放自定义数据，分类中添加属性也会用到   </p>
<ul>
<li>给对象存储信息，通常会创建对象所属类的子类；但某些情况下无法创建子类（分类），只能通过关联属性值的方式</li>
<li>关联属性值可能会出现循环引用问题</li>
</ul>
<h3 id="AssociatedObject的本质"><a href="#AssociatedObject的本质" class="headerlink" title="AssociatedObject的本质"></a>AssociatedObject的本质</h3><p> 通过objc_setAssociatedObject给分类创建的属性放在了一个全局的AssociationManager中；<br> 通过对象的地址找到AssociationManager中的hashMap，然后通过属性的Key来获取属性的value；   </p>
<h3 id="AssociatedObject具体使用"><a href="#AssociatedObject具体使用" class="headerlink" title="AssociatedObject具体使用"></a>AssociatedObject具体使用</h3><pre><code>    #import &quot;AssociatedObject.h&quot;
#import &lt;objc/runtime.h&gt;
@implementation AssociatedObject
static void* associatedObjectKey = &quot;associatedObjectKey&quot;;

-(void)askQuestion{
    void (^block)(NSInteger index)= ^(NSInteger index){
        if (0 == index) {
            [self confrim];
        }else if (1 == index){
            [self cancel];
        }
    };

    objc_setAssociatedObject(self, associatedObjectKey, block, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

-(void)associated:(AssociatedObject*)associated index:(NSInteger)index{
    void (^block)(NSInteger index) = objc_getAssociatedObject(associated, associatedObjectKey);
    block(index);
}

-(void)confrim{
  // Class test_class = [NSString class];
}
-(void)cancel{

}
@end
</code></pre><p> 文章参考：<br> <a href="http://blog.leichunfeng.com/blog/2015/06/26/objective-c-associated-objects-implementation-principle/" target="_blank" rel="external">Objective-C Associated Objects 的实现原理
</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/04/生活篇--说说三观/" class="prev">PREV</a><a href="/2017/03/04/OC基础之分类-Category/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">华子</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>