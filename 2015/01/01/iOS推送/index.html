<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS基础," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="本地通知目前市面是存在很多的app可以根据用户的时间设置提供定时提醒功能，通常提醒的消息会从状态栏顶部弹出，几秒后消失，并且在通知中心中能够停留，用户点击通知内容会拉起app；这个功能通常的实现是用到了UILocalNotification；">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS本地通知和推送初识">
<meta property="og:url" content="http://yoursite.com/2015/01/01/iOS推送/index.html">
<meta property="og:site_name" content="華">
<meta property="og:description" content="本地通知目前市面是存在很多的app可以根据用户的时间设置提供定时提醒功能，通常提醒的消息会从状态栏顶部弹出，几秒后消失，并且在通知中心中能够停留，用户点击通知内容会拉起app；这个功能通常的实现是用到了UILocalNotification；">
<meta property="og:image" content="http://docs.jiguang.cn/client/image/jpush_ios.png">
<meta property="og:updated_time" content="2016-07-25T07:17:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS本地通知和推送初识">
<meta name="twitter:description" content="本地通知目前市面是存在很多的app可以根据用户的时间设置提供定时提醒功能，通常提醒的消息会从状态栏顶部弹出，几秒后消失，并且在通知中心中能够停留，用户点击通知内容会拉起app；这个功能通常的实现是用到了UILocalNotification；">
<meta name="twitter:image" content="http://docs.jiguang.cn/client/image/jpush_ios.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2015/01/01/iOS推送/"/>





  <title> iOS本地通知和推送初识 | 華 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">華</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/01/01/iOS推送/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="华子">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://tva2.sinaimg.cn/crop.0.0.639.639.180/8e8e3b1bjw8evv5nqax26j20hs0hrwf5.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="華">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOS本地通知和推送初识
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-01T09:30:00+08:00">
                2015-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="本地通知"><a href="#本地通知" class="headerlink" title="本地通知"></a>本地通知</h3><p>目前市面是存在很多的app可以根据用户的时间设置提供定时提醒功能，通常提醒的消息会从状态栏顶部弹出，几秒后消失，并且在通知中心中能够停留，用户点击通知内容会拉起app；这个功能通常的实现是用到了<strong>UILocalNotification</strong>；<br><a id="more"></a></p>
<h4 id="什么是UILocalNotification"><a href="#什么是UILocalNotification" class="headerlink" title="什么是UILocalNotification"></a>什么是UILocalNotification</h4><blockquote>
<p>A UILocalNotification object specifies a notification that an app can schedule for presentation at a specific date and time. The operating system is responsible for delivering local notifications at their scheduled times; the app does not have to be running for this to happen. Although local notifications are similar to remote notifications in that they are used for displaying alerts, playing sounds, and badging app icons, they are composed and delivered locally and do not require connection with remote servers.</p>
<p>大体上就是说UILocalNotification能根据日期或是时间设定，将要通知的时间加入到系统中，在设定的时刻触发提醒</p>
</blockquote>
<h4 id="如何使用UILocalNotification"><a href="#如何使用UILocalNotification" class="headerlink" title="如何使用UILocalNotification"></a>如何使用UILocalNotification</h4><pre><code>- (IBAction)localNotificationAction:(id)sender {
    UILocalNotification* localNotification =[[UILocalNotification alloc] init];
    localNotification.fireDate = [NSDate dateWithTimeIntervalSinceNow:10.0f];
    localNotification.timeZone = [NSTimeZone defaultTimeZone];
    localNotification.alertBody = @&quot;事件提醒&quot;;
    localNotification.alertAction = @&quot;查看具体消息&quot;;
    localNotification.hasAction = YES;
    localNotification.alertTitle = @&quot;通知的标题&quot;;
    localNotification.userInfo = @{@&quot;name&quot;:@&quot;hua&quot;,@&quot;age&quot;:@&quot;18&quot;};
    localNotification.applicationIconBadgeNumber = 1;
    // 调度通知
   [[UIApplication sharedApplication] scheduleLocalNotification:localNotification];
}
</code></pre><h4 id="新增了一个UILocalNotification为什么-void-application-UIApplication-application-didReceiveLocalNotification-UILocalNotification-notification方法没有触发"><a href="#新增了一个UILocalNotification为什么-void-application-UIApplication-application-didReceiveLocalNotification-UILocalNotification-notification方法没有触发" class="headerlink" title="新增了一个UILocalNotification为什么-(void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification方法没有触发"></a>新增了一个UILocalNotification为什么<code>-(void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification</code>方法没有触发</h4><p>在iOS8版本之后发本地通知也需要获取用户的权限所以需要在程序启动时进行确认</p>
<pre><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
// Override point for customization after application launch.
//iOS8 之后需要获取用户的许可才能执行
UIUserNotificationSettings *settings = [UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeAlert|UIUserNotificationTypeBadge|UIUserNotificationTypeSound categories:nil];
[[UIApplication sharedApplication] registerUserNotificationSettings:settings];
return YES;
}
</code></pre><h5 id="应用进程被杀死之后，获取的本地通知信息该如何展示？"><a href="#应用进程被杀死之后，获取的本地通知信息该如何展示？" class="headerlink" title="应用进程被杀死之后，获取的本地通知信息该如何展示？"></a>应用进程被杀死之后，获取的本地通知信息该如何展示？</h5><pre><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
// Override point for customization after application launch.
//iOS8 之后需要获取用户的许可才能执行
UIUserNotificationSettings *settings = [UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeAlert|UIUserNotificationTypeBadge|UIUserNotificationTypeSound categories:nil];
[[UIApplication sharedApplication] registerUserNotificationSettings:settings];
// 如果本地通知的信息不为空
if (launchOptions[UIApplicationLaunchOptionsLocalNotificationKey]) {
    // 当被杀死状态收到本地通知时执行的跳转代码
   // 根据UIApplicationLaunchOptionsLocalNotificationKey可以获取本地通知的详细信息
    UIAlertView* alertView = [[UIAlertView alloc] initWithTitle:@&quot;本地通知&quot; message:[launchOptions description] delegate:nil cancelButtonTitle:@&quot;确定&quot; otherButtonTitles:@&quot;&quot;, nil];
    [alertView show];
}
return YES;
}
</code></pre><p>应用进程被杀死之后 在didFinishLauchingWithOption:方法获取本地通知信息后，<code>-(void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification</code>该方法不会再被触发</p>
<h3 id="远程推送"><a href="#远程推送" class="headerlink" title="远程推送"></a>远程推送</h3><p>目前接触到开发的app对于推送开发都是集成三方的SDK，在应用启动时注册，然后通过三方提供的api服务端根据上传的devicetoken向指定用户推送消息；虽然三方发SDK已经非常方便但是对于apple 的APNs服务还是需要搞清楚基本的运行流程；</p>
<h4 id="（1）注册远程推送"><a href="#（1）注册远程推送" class="headerlink" title="（1）注册远程推送"></a>（1）注册远程推送</h4><p> 应用启动时在<code>didFinishLaunchingWithOptions:</code>方法中注册远程通知，这时具体会上传UDID和bundle identifier给APNs；</p>
<pre><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
if ([[UIDevice currentDevice].systemVersion doubleValue] &gt;= 8.0) {
    // 1.注册远程推送
    [application registerForRemoteNotifications];
} else {
    [application registerForRemoteNotificationTypes:UIRemoteNotificationTypeNewsstandContentAvailability | UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound];
}
return YES;
}
</code></pre><h4 id="（2）APNs的回调"><a href="#（2）APNs的回调" class="headerlink" title="（2）APNs的回调"></a>（2）APNs的回调</h4><pre><code>-(void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken{
// 在此将deviceToken上传到自己的服务端
}
</code></pre><h4 id="（3）app服务端将deviceToken-消息传给APNs-这样指定的用户在权限打开的状态下是能够获取到消息的"><a href="#（3）app服务端将deviceToken-消息传给APNs-这样指定的用户在权限打开的状态下是能够获取到消息的" class="headerlink" title="（3）app服务端将deviceToken+消息传给APNs,这样指定的用户在权限打开的状态下是能够获取到消息的"></a>（3）app服务端将deviceToken+消息传给APNs,这样指定的用户在权限打开的状态下是能够获取到消息的</h4><hr>
<p>关于实现在生产环境和开发环境上的推送功能可以参照极光推送官网的文档进行配置；下图是极光实现推送通知的概要图；</p>
<center><br><img src="http://docs.jiguang.cn/client/image/jpush_ios.png" alt="清醒思考的艺术"><br></center> 




      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS基础/" rel="tag"># iOS基础</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/12/02/数据结构之单链表/" rel="next" title="数据结构之单链表">
                <i class="fa fa-chevron-left"></i> 数据结构之单链表
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/01/05/hello-world/" rel="prev" title="CocoaPods 初识">
                CocoaPods 初识 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva2.sinaimg.cn/crop.0.0.639.639.180/8e8e3b1bjw8evv5nqax26j20hs0hrwf5.jpg"
               alt="华子" />
          <p class="site-author-name" itemprop="name">华子</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地通知"><span class="nav-number">1.</span> <span class="nav-text">本地通知</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是UILocalNotification"><span class="nav-number">1.1.</span> <span class="nav-text">什么是UILocalNotification</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何使用UILocalNotification"><span class="nav-number">1.2.</span> <span class="nav-text">如何使用UILocalNotification</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增了一个UILocalNotification为什么-void-application-UIApplication-application-didReceiveLocalNotification-UILocalNotification-notification方法没有触发"><span class="nav-number">1.3.</span> <span class="nav-text">新增了一个UILocalNotification为什么-(void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification方法没有触发</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#应用进程被杀死之后，获取的本地通知信息该如何展示？"><span class="nav-number">1.3.1.</span> <span class="nav-text">应用进程被杀死之后，获取的本地通知信息该如何展示？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程推送"><span class="nav-number">2.</span> <span class="nav-text">远程推送</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#（1）注册远程推送"><span class="nav-number">2.1.</span> <span class="nav-text">（1）注册远程推送</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（2）APNs的回调"><span class="nav-number">2.2.</span> <span class="nav-text">（2）APNs的回调</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（3）app服务端将deviceToken-消息传给APNs-这样指定的用户在权限打开的状态下是能够获取到消息的"><span class="nav-number">2.3.</span> <span class="nav-text">（3）app服务端将deviceToken+消息传给APNs,这样指定的用户在权限打开的状态下是能够获取到消息的</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">华子</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
